<!DOCTYPE html><html lang="it"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Estrattore Palette colore - Codedge</title><meta name="description" content="Carica una foto e ottieni palette colori, suggerimenti di contrasto, gradienti, ruoli UI, CSS variables e JSON esportabili. Tutto client-side."><link rel="canonical" href="https://codedge.it/strumenti/estrattore-palette/"><link rel="icon" href="/assets/icons/codedge-logo-minimal.svg" sizes="any" type="image/svg+xml"><link rel="icon" href="/assets/icons/favicon-32.png" sizes="32x32" type="image/png"><link rel="icon" href="/assets/icons/favicon-16.png" sizes="16x16" type="image/png"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/icons/android-chrome-192.png" sizes="192x192" type="image/png"><link rel="icon" href="/assets/icons/android-chrome-512.png" sizes="512x512" type="image/png"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png" sizes="180x180"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/assets/icons/favicon-mask.svg" color="#00A8FF"><meta name="theme-color" content="#00A8FF"><link rel="preload" href="../../css/components/main.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript><link rel="preload" href="../../css/components/navbar.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="preload" href="../../css/components/footer.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="../../css/components/navbar.css"><link rel="stylesheet" href="../../css/components/footer.css"></noscript><script src="../../js/components/navbar.js" defer=""></script><script src="../../js/components/button.js" defer=""></script><script src="../../js/components/footer.js"></script><script src="../../js/components/navbar-loader.js"></script><style>@keyframes flashOutline{0%{box-shadow:0 0 0 0 rgba(0,123,240,.6)}to{box-shadow:0 0 0 10px transparent}}:root{--bg:#2a2a2a;--panel:#3a3a3a;--panel-2:#363636;--card-grad:linear-gradient(180deg, #3c3c3c, #373737);--surface-grad:linear-gradient(180deg, var(--panel), var(--panel-2));--btn-grad:linear-gradient(180deg, #404040, #353535);--text:#f2f2f2;--muted:#e0e0e0;--hover:#007bf0;--radius:14px;--radius-lg:16px;--gap:12px;--shadow-sm:0 1px 0 rgba(0, 0, 0, 0.55);--shadow-inset:inset 0 1px 0 rgba(255, 255, 255, 0.04);--shadow-card:0 20px 60px rgba(0, 0, 0, 0.45);--shadow-panel:0 12px 32px rgba(0, 0, 0, 0.38);--panel-heading-gap:18px}*{box-sizing:border-box}.thumb img,body,html{height:100%}.tiny,body{color:var(--text)}body{margin:0;background:var(--bg);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;line-height:1.4}h1{font-size:clamp(20px,4vw,30px);margin:0 0 8px}h2{font-size:1.5rem;text-align:center;margin:20px}.panel h3{margin:0 0 var(--panel-heading-gap)}.tiny{font-size:.95rem;opacity:.92;line-height:1.7}.wrap{width:100%;max-width:none;padding-inline:clamp(12px,4vw,48px);padding-block:18px;margin:0 auto}.card{background:var(--card-grad);border-radius:var(--radius-lg);border:0;box-shadow:var(--shadow-card),var(--shadow-inset);padding:18px;width:100%;overflow:auto}.block,.panel{padding:16px}.block,.panel,.role-row{background:var(--surface-grad);border-radius:var(--radius);box-shadow:var(--shadow-panel),var(--shadow-inset);border:0}.grid{display:grid;grid-template-columns:minmax(0,1.1fr) minmax(0,.9fr) minmax(0,.9fr);gap:18px;padding:18px}@media (max-width:1200px){.grid{grid-template-columns:1fr;padding:12px;gap:14px}}.upload{gap:var(--gap);justify-content:space-between;padding:22px;border:2px dashed var(--hover);border-radius:14px;background:var(--surface-grad);position:relative;box-shadow:0 10px 28px rgba(0,0,0,.35);transition:box-shadow .15s ease;flex-wrap:wrap}.upload.dragover{border-color:var(--hover);box-shadow:inset 0 0 0 3px rgba(0,123,240,.25),0 10px 28px rgba(0,123,240,.15)}.upload,.upload .left{display:flex;align-items:center}.upload .left{gap:16px;min-width:0}.thumb{width:clamp(96px,16vw,260px);aspect-ratio:16/9;border-radius:12px;background:#2f2f2f;display:grid;place-items:center;overflow:hidden;box-shadow:inset 0 1px 0 rgba(255,255,255,.03),var(--shadow-sm);flex:0 0 auto}.thumb img{display:block;width:100%;object-fit:cover}.foot,.row,.upload .actions{display:flex;gap:8px;flex-wrap:wrap}.foot{margin-top:10px}.upload .actions{align-items:center}.ghost,.primary,button{background:var(--btn-grad)}.ghost,button{border:0;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;min-height:44px;transition:transform .08s ease,box-shadow .15s ease,background-color .15s ease;box-shadow:inset 1px 1px 0 rgba(255,255,255,.1),inset -1px -1px 0 rgba(0,0,0,.3),0 2px 4px rgba(0,0,0,.2)}.ghost:active,button:active{transform:translateY(1px)}.ghost:hover,.primary:hover,button:hover{background:var(--hover);box-shadow:inset 0 .5px 0 rgba(255,255,255,.08),0 1px 0 rgba(0,0,0,.45),0 3px 6px rgba(0,123,240,.12)}.primary{margin-left:5px}.palette{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px}.swatch{border-radius:12px;background:#2f2f2f;overflow:hidden;box-shadow:inset 0 1px 0 rgba(255,255,255,.03),0 1px 0 rgba(0,0,0,.6)}.swatch .chip{height:84px}.swatch .meta{padding:10px;font:12px/1.4 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;color:var(--muted)}.role-row{display:flex;align-items:center;gap:12px;padding:10px 12px}.grad-pill,.role-row .chip-role{border:1px solid rgba(204,204,204,.22)}.role-row .chip-role{width:44px;height:44px;border-radius:10px;flex:0 0 auto}.grad-pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;min-height:44px;background:linear-gradient(180deg,#3b3b3b,#343434);box-shadow:inset 0 1px 0 rgba(255,255,255,.05),0 2px 0 rgba(0,0,0,.5),0 10px 22px rgba(0,0,0,.3);cursor:pointer;margin:auto}.badge,.grad-chip,.grad-pill{border-radius:999px}.grad-chip{width:14px;height:14px;display:inline-block;vertical-align:middle;box-shadow:0 0 0 1px rgba(204,204,204,.22) inset;pointer-events:none}.grad-pill .label{white-space:nowrap}.grad-pill.flash{animation:flashOutline .62s ease-out}.badge{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;font-size:11px;border:1px solid rgba(204,204,204,.22);background:0 0}.mt8{margin-top:8px}.mt12{margin-top:12px}.center{text-align:center}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}.two{display:grid;grid-template-columns:1fr 1fr;gap:12px}@media (max-width:820px){.two{grid-template-columns:1fr}}.ghost:focus-visible,.grad-pill:focus-visible,.upload:focus-visible,button:focus-visible{outline:3px solid var(--hover);outline-offset:2px;box-shadow:0 0 0 3px rgba(0,123,240,.25)}.grid>*,.left,.mono,.panel,.role-row,.row,.thumb,button,input,label{min-width:0}.mono,button,input,label{word-break:break-word}.site-footer,footer{position:static;width:100%;z-index:auto}@media (max-width:520px){.upload{flex-direction:column;align-items:stretch;padding:16px;gap:12px}.upload .left{width:100%;gap:12px;align-items:center;min-width:0}.thumb{width:96px;height:auto;aspect-ratio:4/3}.upload .actions{justify-content:flex-end;width:100%;gap:8px;flex-wrap:wrap}.upload .actions .primary{min-width:120px;max-width:100%;white-space:nowrap;align-self:center;z-index:2}.upload .actions .ghost,.upload .actions button{flex:0 0 auto}}</style></head><body><header><nav class="navbar"><div class="navbar-container"><img src="../../assets/icons/codedge-logo.svg" alt="Logo codedge" class="logo" width="80" height="35"><h1 class="resize-text"><i class="fas fa-eye-dropper"></i> Estrattore Palette</h1><div class="menu-icon"><span class="bar"></span> <span class="bar"></span> <span class="bar"></span></div><ul id="nav-menu" class="nav-menu"></ul></div></nav><div id="breadcrumb-container" aria-hidden="false"></div><script src="../../js/components/breadcrumb-loader.js" defer=""></script></header><h2>Estrai palette colori dalla tua foto — CSS, gradienti e JSON</h2><div class="wrap"><div class="card"><p class="tiny">Carica una <strong>foto</strong> o trascinala qui: ottieni <strong>palette dominanti</strong>, suggerimenti di <strong>contrasto</strong>, <strong>gradienti</strong>, ruoli <strong>UI</strong> (bg/primary/accent), e <strong>CSS variables</strong> + <strong>JSON</strong> esportabili. Tutto <em>client-side</em>.</p><div class="grid"><div class="panel"><h3>Input immagine</h3><div class="upload" id="drop" role="button" aria-label="Carica immagine: clicca o trascina e rilascia" aria-describedby="drop-hint"><div class="left"><div class="thumb" id="thumb"><span class="tiny">anteprima</span></div><div><div class="tiny" id="drop-hint">Consiglio: immagini &lt; 4MB • verranno ridotte per l'analisi (max 500px)</div><div class="foot"><label class="ghost" for="file">Scegli file…</label> <input id="file" type="file" accept="image/*" hidden=""> <button id="demo" class="ghost">Usa demo</button> <button id="reset" class="ghost">Reset</button></div></div></div><div class="actions"><button id="analyze" class="primary">Estrai palette</button></div></div><div class="two mt12"><div class="block"><div class="tiny">Dimensioni immagine</div><div id="info-dim" class="mono">—</div></div><div class="block"><div class="tiny">Luminosità media</div><div class="bar" id="avg-bar-outer" role="progressbar" aria-valuemin="0" aria-valuemax="255" aria-valuenow="0" aria-label="Luminosità media"><div id="avg-bar" style="width:0;background:linear-gradient(90deg,#4a4a4a,#9a9a9a)"></div></div><div id="avg-val" class="mono tiny">—</div></div></div></div><div class="panel"><h3>Palette dominante</h3><div id="palette" class="palette"><div class="hint">Carica un'immagine e premi “Estrai palette”.</div></div></div><div class="panel"><h3>Ruoli UI suggeriti</h3><p class="roles-desc tiny">Significato pratico: <strong>Background</strong> = colore di fondo della pagina; <strong>Primary</strong> = colore principale (brand, titoli, bottoni); <strong>Accent</strong> = tocchi di evidenza/CTA/link; <strong>Text</strong> = colore del testo che massimizza il contrasto su Background.</p><div id="roles" class="two"><div class="role-row" id="role-bg"><div class="chip-role"></div><div class="role-meta"><div class="role-name">Background</div><div class="role-hex mono tiny">—</div></div></div><div class="role-row" id="role-primary"><div class="chip-role"></div><div class="role-meta"><div class="role-name">Primary</div><div class="role-hex mono tiny">—</div></div></div><div class="role-row" id="role-accent"><div class="chip-role"></div><div class="role-meta"><div class="role-name">Accent</div><div class="role-hex mono tiny">—</div></div></div><div class="role-row" id="role-text"><div class="chip-role"></div><div class="role-meta"><div class="role-name">Text</div><div class="role-hex mono tiny">—</div></div></div></div><div class="mt12"><div class="tiny">Gradienti (sfumature) <span style="opacity:.85">— clicca per copiare il CSS</span></div><ul id="grads-help" class="tiny grad-explain"><li><strong>Contrasto forte</strong>: sfumatura tra i <em>due colori più diversi</em> della foto. Per hero/sfondi che devono spiccare.</li><li><strong>Evidenza → Principale</strong>: dal colore di <em>evidenza</em> (accent) al colore <em>principale</em> del tema. Per bottoni/CTA o badge.</li></ul><div id="grads" class="row mt8"></div></div></div><div class="panel"><h3>Cos’è e come usarlo</h3><p class="tiny">Carica una foto, estrai la palette, poi usa i ruoli UI per costruire rapidamente un tema. Mantieni il <strong>contrasto</strong> almeno AA per testi e bottoni. Esporta le variabili CSS o il JSON e incollale nel tuo progetto.</p><ol class="tiny" style="margin:0;padding-left:18px;line-height:1.6"><li><strong>Carica</strong> immagine e premi “Estrai palette”.</li><li><strong>Seleziona</strong> i colori proposti come Background/Primary/Accent/Text.</li><li><strong>Verifica</strong> i rapporti (pallini e numeri) e scegli combinazioni leggibili.</li><li><strong>Esporta</strong> CSS/JSON e usali nel tuo progetto.</li></ol></div><div class="panel"><h3>Esporta</h3><div class="row"><button id="copy-css">Copia CSS variables</button> <button id="copy-json">Copia JSON</button> <button id="dl-css">Download .css</button> <button id="dl-json">Download .json</button></div><div class="mt8 tiny" id="export-info" role="status" aria-live="polite">—</div><details class="mt12"><summary class="tiny">Diagnostica</summary><div class="tiny mono" id="diag">Pronto.</div></details></div></div></div><p class="tiny center mt12">MVP client-side. K-Means su campionamento — 6 cluster. WCAG contrast.</p></div><canvas id="canvas" style="display:none"></canvas><script>!(function () {
        "use strict";
        const toHex = (t) => t.toString(16).padStart(2, "0"),
          rgbToHex = ({ r: t, g: e, b: a }) =>
            "#" + toHex(t) + toHex(e) + toHex(a);
        function rgbToHsl(t, e, a) {
          ((t /= 255), (e /= 255), (a /= 255));
          const n = Math.max(t, e, a),
            r = Math.min(t, e, a);
          let o,
            s,
            c = (n + r) / 2;
          if (n === r) o = s = 0;
          else {
            const i = n - r;
            switch (((s = c > 0.5 ? i / (2 - n - r) : i / (n + r)), n)) {
              case t:
                o = (e - a) / i + (e < a ? 6 : 0);
                break;
              case e:
                o = (a - t) / i + 2;
                break;
              default:
                o = (t - e) / i + 4;
            }
            o /= 6;
          }
          return {
            h: Math.round(360 * o),
            s: Math.round(100 * s),
            l: Math.round(100 * c),
          };
        }
        function luminance({ r: t, g: e, b: a }) {
          const n = [t, e, a]
            .map((t) => t / 255)
            .map((t) =>
              t <= 0.03928 ? t / 12.92 : Math.pow((t + 0.055) / 1.055, 2.4),
            );
          return 0.2126 * n[0] + 0.7152 * n[1] + 0.0722 * n[2];
        }
        function contrastRatio(t, e) {
          const a = luminance(t),
            n = luminance(e);
          return (Math.max(a, n) + 0.05) / (Math.min(a, n) + 0.05);
        }
        function pickTextColor(t) {
          const e = { r: 255, g: 255, b: 255 },
            a = { r: 0, g: 0, b: 0 },
            n = contrastRatio(t, e),
            r = contrastRatio(t, a);
          return n >= r
            ? { hex: "#ffffff", ratio: n, rgb: e }
            : { hex: "#000000", ratio: r, rgb: a };
        }
        const $ = (t) => document.getElementById(t),
          t = $("file"),
          e = $("drop"),
          a = $("thumb"),
          n = $("analyze"),
          r = $("info-dim"),
          o = $("avg-bar"),
          s = $("avg-val"),
          c = $("palette"),
          i = {
            bg: $("role-bg"),
            primary: $("role-primary"),
            accent: $("role-accent"),
            text: $("role-text"),
          },
          l = $("grads"),
          d = $("export-info"),
          h = $("diag"),
          g = $("copy-css"),
          u = $("copy-json"),
          p = $("dl-css"),
          f = $("dl-json"),
          b = $("demo"),
          m = $("reset");
        let x = [],
          y = null;
        function setThumb(t) {
          a.innerHTML = '<img alt="Anteprima immagine" src="' + t + '"/>';
        }
        function loadImageFile(t) {
          return new Promise((e, a) => {
            const n = new FileReader();
            ((n.onload = () => e(n.result)),
              (n.onerror = a),
              n.readAsDataURL(t));
          });
        }
        function contrast(t, e) {
          return contrastRatio(t, e);
        }
        function createGrad(t, e, a, n) {
          const r = document.createElement("div");
          return (
            (r.className = "grad-pill"),
            r.setAttribute("role", "button"),
            (r.tabIndex = 0),
            (r.innerHTML =
              '<span class="grad-chip" style="background:' +
              e +
              '"></span><span class="label">' +
              t +
              '</span><span class="grad-chip" style="background:' +
              a +
              '"></span>'),
            (r.style.background = "linear-gradient(90deg," + e + "," + a + ")"),
            (r.style.color = pickTextColor(
              (function hexToRgb(t) {
                let e = t.replace("#", "");
                return (
                  3 === e.length &&
                    (e = e
                      .split("")
                      .map((t) => t + t)
                      .join("")),
                  {
                    r: parseInt(e.slice(0, 2), 16),
                    g: parseInt(e.slice(2, 4), 16),
                    b: parseInt(e.slice(4, 6), 16),
                  }
                );
              })(e),
            ).hex),
            (r.dataset.from = e),
            (r.dataset.to = a),
            (r.dataset.label = t),
            (r.title =
              (n || t) + " — " + e + " → " + a + " (clicca per copiare CSS)"),
            r
          );
        }
        async function safeCopy(t) {
          try {
            if (!navigator.clipboard || !window.isSecureContext)
              throw new Error("clipboard non disponibile");
            return (
              await navigator.clipboard.writeText(t),
              { ok: !0, method: "clipboard" }
            );
          } catch (e) {
            try {
              const e = document.createElement("textarea");
              ((e.value = t),
                e.setAttribute("readonly", ""),
                (e.style.position = "fixed"),
                (e.style.top = "-9999px"),
                (e.style.opacity = "0"),
                document.body.appendChild(e),
                e.focus(),
                e.select(),
                e.setSelectionRange(0, e.value.length));
              const a = document.execCommand("copy");
              if ((document.body.removeChild(e), !a))
                throw new Error("execCommand fallito");
              return { ok: !0, method: "execCommand" };
            } catch (t) {
              return { ok: !1, error: t };
            }
          }
        }
        function downloadText(t, e) {
          const a = new Blob([e], { type: "text/plain" }),
            n = document.createElement("a");
          ((n.href = URL.createObjectURL(a)),
            (n.download = t),
            n.click(),
            setTimeout(() => URL.revokeObjectURL(n.href), 1e3));
        }
        function cssVariables() {
          if (!x.length) return "";
          const t = [":root {"];
          return (
            x.forEach((e, a) =>
              t.push("  --color-" + (a + 1) + ": " + e.hex + ";"),
            ),
            y &&
              t.push(
                "  --bg: " + y.bg.hex + ";",
                "  --primary: " + y.primary.hex + ";",
                "  --accent: " + y.accent.hex + ";",
                "  --text: " + y.text.hex + ";",
              ),
            t.push(
              "}",
              "",
              "/* Esempio d'uso */",
              "body { background: var(--bg); color: var(--text); }",
              ".btn-primary { background: var(--primary); color: var(--text); }",
              ".btn-accent { background: var(--accent); color: var(--text); }",
            ),
            t.join("\n")
          );
        }
        function asJSON() {
          const t = {
            palette: x.map((t) => ({
              hex: t.hex,
              rgb: { r: t.r, g: t.g, b: t.b },
            })),
            roles: y
              ? {
                  bg: y.bg.hex,
                  primary: y.primary.hex,
                  accent: y.accent.hex,
                  text: y.text.hex,
                }
              : null,
          };
          return JSON.stringify(t, null, 2);
        }
        (t.addEventListener("change", async (t) => {
          const e = t.target.files && t.target.files[0];
          e && setThumb(await loadImageFile(e));
        }),
          e.addEventListener("dragover", (t) => {
            (t.preventDefault(), e.classList.add("dragover"));
          }),
          e.addEventListener("dragleave", () => e.classList.remove("dragover")),
          e.addEventListener("drop", async (t) => {
            (t.preventDefault(), e.classList.remove("dragover"));
            const a = t.dataTransfer.files && t.dataTransfer.files[0];
            a && setThumb(await loadImageFile(a));
          }),
          e.addEventListener("keydown", (e) => {
            ("Enter" !== e.key && " " !== e.key) ||
              (e.preventDefault(), t.click());
          }),
          n.addEventListener("click", async () => {
            const t = a.querySelector("img");
            if (t) {
              ((n.disabled = !0), (d.textContent = "Analizzo…"));
              try {
                const { clusters: e } = await (function analyze(t) {
                  return new Promise((e, a) => {
                    const n = new Image();
                    ((n.crossOrigin = "anonymous"),
                      (n.onload = () => {
                        ((r.textContent =
                          n.naturalWidth + "×" + n.naturalHeight + "px"),
                          setThumb(t));
                        const { pixels: a, avg: c } = (function drawAndSample(
                          t,
                        ) {
                          const e = $("canvas"),
                            a = e.getContext("2d"),
                            n = Math.min(1, 500 / Math.max(t.width, t.height)),
                            r = Math.max(1, Math.round(t.width * n)),
                            o = Math.max(1, Math.round(t.height * n));
                          ((e.width = r),
                            (e.height = o),
                            a.drawImage(t, 0, 0, r, o));
                          const { data: s } = a.getImageData(0, 0, r, o),
                            c = [],
                            i = Math.max(1, Math.floor((r * o) / 6e3));
                          let l = 0,
                            d = 0;
                          for (let t = 0; t < s.length; t += 4 * i) {
                            if (s[t + 3] / 255 < 0.5) continue;
                            const e = s[t],
                              a = s[t + 1],
                              n = s[t + 2];
                            (c.push({ r: e, g: a, b: n }),
                              (l += (e + a + n) / 3),
                              d++);
                          }
                          return {
                            pixels: c,
                            w: r,
                            h: o,
                            avg: Math.round(l / Math.max(1, d)),
                          };
                        })(n);
                        ((o.style.width = ((c / 255) * 100).toFixed(0) + "%"),
                          (s.textContent = c + " / 255"),
                          $("avg-bar-outer").setAttribute(
                            "aria-valuenow",
                            String(c),
                          ));
                        const i = (function kmeans(t, e = 6, a = 12) {
                          if (!t.length) return [];
                          const n = [],
                            r = new Set();
                          for (; n.length < e; ) {
                            const e = Math.floor(Math.random() * t.length);
                            r.has(e) || (r.add(e), n.push({ ...t[e] }));
                          }
                          let o = new Array(t.length).fill(0);
                          for (let r = 0; r < a; r++) {
                            for (let e = 0; e < t.length; e++) {
                              const a = t[e];
                              let r = 0,
                                s = 1 / 0;
                              for (let t = 0; t < n.length; t++) {
                                const e = n[t],
                                  o =
                                    (a.r - e.r) ** 2 +
                                    (a.g - e.g) ** 2 +
                                    (a.b - e.b) ** 2;
                                o < s && ((s = o), (r = t));
                              }
                              o[e] = r;
                            }
                            const a = Array.from({ length: e }, () => ({
                              r: 0,
                              g: 0,
                              b: 0,
                              count: 0,
                            }));
                            for (let e = 0; e < t.length; e++) {
                              const n = t[e],
                                r = a[o[e]];
                              ((r.r += n.r),
                                (r.g += n.g),
                                (r.b += n.b),
                                r.count++);
                            }
                            for (let t = 0; t < e; t++)
                              a[t].count > 0 &&
                                (n[t] = {
                                  r: Math.round(a[t].r / a[t].count),
                                  g: Math.round(a[t].g / a[t].count),
                                  b: Math.round(a[t].b / a[t].count),
                                });
                          }
                          const s = Array.from({ length: e }, (t, e) => ({
                            color: n[e],
                            count: 0,
                          }));
                          return (
                            o.forEach((t) => s[t].count++),
                            s
                              .filter((t) => t.count > 0)
                              .sort((t, e) => e.count - t.count)
                          );
                        })(a, 6, 12);
                        e({ clusters: i });
                      }),
                      (n.onerror = a),
                      (n.src = t));
                  });
                })(t.src);
                (!(function renderPalette(t) {
                  ((c.innerHTML = ""),
                    (x = t.map((t) => ({
                      ...t.color,
                      hex: rgbToHex(t.color),
                      count: t.count,
                    }))),
                    x.forEach((t, e) => {
                      const a = rgbToHsl(t.r, t.g, t.b),
                        n = pickTextColor(t),
                        r = document.createElement("div");
                      ((r.className = "swatch"),
                        (r.innerHTML =
                          '<div class="chip" style="background:' +
                          t.hex +
                          '"></div><div class="meta"><div class="row"><span class="badge">#' +
                          String(e + 1).padStart(2, "0") +
                          '</span><span class="badge" style="background:' +
                          t.hex +
                          ";color:" +
                          n.hex +
                          '">Aa ' +
                          n.ratio.toFixed(1) +
                          ':1</span></div><div class="mt8 mono">' +
                          t.hex.toUpperCase() +
                          " • rgb(" +
                          t.r +
                          ", " +
                          t.g +
                          ", " +
                          t.b +
                          ") • hsl(" +
                          a.h +
                          " " +
                          a.s +
                          "% " +
                          a.l +
                          "%)</div></div>"),
                        r.setAttribute("role", "img"),
                        r.setAttribute(
                          "aria-label",
                          t.hex.toUpperCase() +
                            " — rgb(" +
                            t.r +
                            ", " +
                            t.g +
                            ", " +
                            t.b +
                            ")",
                        ),
                        c.appendChild(r));
                    }));
                })(e),
                  (function pickRoles() {
                    if (!x.length) return;
                    const getH = (t) => rgbToHsl(t.r, t.g, t.b).h,
                      hueDist = (t, e) => {
                        const a = Math.abs(t - e);
                        return Math.min(a, 360 - a);
                      },
                      t = x[0] || { hex: "#ffffff", r: 255, g: 255, b: 255 },
                      e = x[1] || t,
                      a = x.slice(2).length ? x.slice(2) : x;
                    let n = a.filter(
                      (a) =>
                        hueDist(getH(a), getH(t)) >= 25 &&
                        hueDist(getH(a), getH(e)) >= 25,
                    );
                    (n.length || (n = a),
                      n.sort(
                        (e, a) =>
                          Math.abs(contrast(e, t) - 4) -
                          Math.abs(contrast(a, t) - 4),
                      ));
                    const r = n[0] || e;
                    let o = t,
                      s = -1;
                    for (const e of x) {
                      const a = contrast(e, t);
                      rgbToHex(e) !== rgbToHex(t) &&
                        a > s &&
                        ((s = a), (o = e));
                    }
                    if (s < 3) {
                      const e = pickTextColor(t);
                      o = { hex: e.hex, r: e.rgb.r, g: e.rgb.g, b: e.rgb.b };
                    }
                    ((y = { bg: t, primary: e, accent: r, text: o }),
                      ["bg", "primary", "accent", "text"].forEach((t) => {
                        const e = i[t];
                        ((e.querySelector(".chip-role").style.background =
                          y[t].hex),
                          (e.querySelector(".role-hex").textContent = y[t].hex),
                          e
                            .querySelector(".chip-role")
                            .setAttribute(
                              "aria-label",
                              `Colore ${t} ${y[t].hex}`,
                            ));
                      }),
                      (function renderGradients() {
                        if (!x.length || !y) return void (l.innerHTML = "");
                        let t = [x[0], x[1]],
                          e = 0;
                        for (let a = 0; a < x.length; a++)
                          for (let n = a + 1; n < x.length; n++) {
                            const r = Math.sqrt(
                              (x[a].r - x[n].r) ** 2 +
                                (x[a].g - x[n].g) ** 2 +
                                (x[a].b - x[n].b) ** 2,
                            );
                            r > e && ((e = r), (t = [x[a], x[n]]));
                          }
                        ((l.innerHTML = ""),
                          l.appendChild(
                            createGrad(
                              "Contrasto forte",
                              t[0].hex,
                              t[1].hex,
                              "I due colori più diversi della foto",
                            ),
                          ),
                          l.appendChild(
                            createGrad(
                              "Evidenza → Principale",
                              y.accent.hex,
                              y.primary.hex,
                              "Dal colore di evidenza al principale",
                            ),
                          ));
                      })());
                  })(),
                  (d.textContent = "Pronto!"));
              } catch (t) {
                (console.error(t),
                  (d.textContent = "Errore analisi immagine."));
              } finally {
                n.disabled = !1;
              }
            } else d.textContent = "Carica prima un'immagine (o usa la demo).";
          }),
          g.addEventListener("click", async () => {
            if (!x.length)
              return void (d.textContent = "Genera la palette prima.");
            const t = cssVariables();
            (await safeCopy(t)).ok
              ? (d.textContent = "CSS copiato ✅")
              : ((d.textContent = "Copia bloccata. Download…"),
                downloadText("palette.css", t));
          }),
          u.addEventListener("click", async () => {
            if (!x.length)
              return void (d.textContent = "Genera la palette prima.");
            const t = asJSON();
            (await safeCopy(t)).ok
              ? (d.textContent = "JSON copiato ✅")
              : ((d.textContent = "Copia bloccata. Download…"),
                downloadText("palette.json", t));
          }),
          p.addEventListener("click", () => {
            x.length && downloadText("palette.css", cssVariables());
          }),
          f.addEventListener("click", () => {
            x.length && downloadText("palette.json", asJSON());
          }),
          l.addEventListener("click", async (t) => {
            const e = t.target.closest(".grad-pill");
            if (!e) return;
            const a = e.dataset.from,
              n = e.dataset.to,
              r = e.dataset.label || "Gradiente",
              o = "background: linear-gradient(90deg, " + a + ", " + n + ");",
              s = await safeCopy(o);
            ((d.textContent = s.ok
              ? "Copiato: " + r + " (" + a + " → " + n + ") ✅"
              : "Copia bloccata. Download…"),
              s.ok || downloadText("gradient.css", o),
              e.classList.remove("flash"),
              e.offsetWidth,
              e.classList.add("flash"));
          }),
          l.addEventListener("keydown", async (t) => {
            if ("Enter" !== t.key && " " !== t.key) return;
            const e = t.target.closest(".grad-pill");
            if (!e) return;
            t.preventDefault();
            const a = e.dataset.from,
              n = e.dataset.to,
              r = e.dataset.label || "Gradiente",
              o = "background: linear-gradient(90deg, " + a + ", " + n + ");",
              s = await safeCopy(o);
            ((d.textContent = s.ok
              ? "Copiato: " + r + " (" + a + " → " + n + ") ✅"
              : "Copia bloccata. Download…"),
              s.ok || downloadText("gradient.css", o),
              e.classList.remove("flash"),
              e.offsetWidth,
              e.classList.add("flash"));
          }),
          b.addEventListener("click", () => {
            const t = [
              '<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500">',
              '<defs><linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">',
              '<stop offset="0%" stop-color="#0ea5e9"/>',
              '<stop offset="50%" stop-color="#22d3ee"/>',
              '<stop offset="100%" stop-color="#a78bfa"/>',
              "</linearGradient></defs>",
              '<rect width="100%" height="100%" fill="url(#g1)"/>',
              '<circle cx="200" cy="180" r="110" fill="#f59e0b"/>',
              '<circle cx="520" cy="320" r="140" fill="#ef4444"/>',
              "</svg>",
            ].join("");
            setThumb("data:image/svg+xml;utf8," + encodeURIComponent(t));
          }),
          m.addEventListener("click", () => {
            ((a.innerHTML = '<span class="tiny">anteprima</span>'),
              (c.innerHTML =
                '<div class="hint">Carica un\'immagine e premi “Estrai palette”.</div>'),
              (r.textContent = "—"),
              (o.style.width = "0%"),
              (s.textContent = "—"),
              $("avg-bar-outer").setAttribute("aria-valuenow", "0"),
              (l.innerHTML = ""),
              (y = null),
              (x = []),
              ["bg", "primary", "accent", "text"].forEach((t) => {
                ((i[t].querySelector(".role-hex").textContent = "—"),
                  (i[t].querySelector(".chip-role").style.background = ""));
              }),
              (d.textContent = "—"));
          }));
        try {
          (console.assert(
            21 ===
              Math.round(
                contrastRatio({ r: 0, g: 0, b: 0 }, { r: 255, g: 255, b: 255 }),
              ),
            "CR black/white=21",
          ),
            console.assert(
              "#102030" === rgbToHex({ r: 16, g: 32, b: 48 }),
              "hex ok",
            ),
            (h.textContent = "Diagnostica: ok"));
        } catch (t) {
          h.textContent = "Diagnostica: " + (t && t.message ? t.message : t);
        }
      })();</script></body></html>